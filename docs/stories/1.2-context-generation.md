# Story 1.2: Context Generation Pipeline

**Status:** Pending
**Epic:** 1 - Foundation & Core Pipeline
**Story ID:** 1.2
**Title:** Context Generation Pipeline
**Slug:** context-generation

## Story

As a parent,
I want to input a natural language story request and generate or update a context file using OpenAI AI parsing,
so that I have a structured representation of my story requirements that can be iteratively built.

## Acceptance Criteria

1. CLI command `jestir context "natural language input"` intelligently creates or updates context.yaml
2. CLI command `jestir context new "natural language input"` always creates a new context.yaml
3. YAML schema implemented as designed (metadata, settings, entities, relationships, user_inputs, plot_points)
4. Default output to context.yaml with option to specify custom filename
5. Entity extraction identifies character names and marks them as new/existing based on LightRAG API queries (mock LightRAG API for now)
6. Relationship extraction identifies basic relationships (visits, finds, creates)
7. Context update functionality merges new entities with existing ones intelligently
8. All user prompts preserved in context file for complete conversation history
9. Unit tests cover YAML generation, structure validation, and context update scenarios
10. Error handling for malformed input

## Tasks/Subtasks

- [ ] Implement context generation service
- [ ] Create YAML schema validation
- [ ] Add OpenAI API integration for entity extraction
- [ ] Implement relationship parsing
- [ ] Create context file update logic
- [ ] Add CLI commands for context generation
- [ ] Implement mock LightRAG API for testing
- [ ] Add comprehensive error handling
- [ ] Create unit tests for all functionality

## Dev Notes

This is the first stage of the core pipeline, converting natural language input into structured context. It depends on project initialization (1.1) being completed and provides the foundation for outline generation (1.3).

## Testing

- Test context generation with various natural language inputs
- Verify YAML schema validation
- Test entity extraction accuracy
- Validate relationship parsing
- Test context update scenarios
- Test error handling for malformed inputs
- Verify mock LightRAG API integration

## QA Results

**Gate Decision**: PENDING
**Review Date**: TBD
**Reviewer**: TBD

**Risk Assessment**: TBD
**Risk Score**: TBD

**Key Findings**: TBD

**Recommendations**: TBD

**Risk Assessment**: [docs/qa/assessments/1.2-context-generation-risk-20241219.md](docs/qa/assessments/1.2-context-generation-risk-20241219.md)
**Gate File**: [docs/qa/gates/1.2-context-generation.yml](docs/qa/gates/1.2-context-generation.yml)

## Change Log

- Initial creation
