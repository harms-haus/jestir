# Story 3.1: Token Usage Tracking

**Status:** Pending
**Epic:** 3 - Advanced Features & Optimization
**Story ID:** 3.1
**Title:** Token Usage Tracking
**Slug:** token-usage-tracking

## Story

As a parent,
I want to track OpenAI API token usage per story,
so that I can optimize costs over time.

## Acceptance Criteria

1. Token counting for each OpenAI API call
2. Token usage stored in context.yaml per generation stage
3. Command `jestir stats` shows token usage summary
4. Cost estimation based on current OpenAI pricing
5. Weekly/monthly usage reports
6. Token optimization suggestions based on patterns

## Tasks/Subtasks

- [ ] Implement token counting for API calls
- [ ] Add token usage storage in context files
- [ ] Create stats command for usage summary
- [ ] Implement cost estimation calculations
- [ ] Add usage reporting functionality
- [ ] Create optimization suggestion system
- [ ] Add pricing configuration
- [ ] Create usage analytics
- [ ] Add export functionality for reports

## Dev Notes

This story adds cost management capabilities by tracking token usage across all OpenAI API calls. It helps users understand and optimize their API costs while providing insights into usage patterns. Token data is stored in context files for complete history tracking.

## Testing

- Test token counting accuracy
- Verify token usage storage in context files
- Test stats command output
- Test cost estimation calculations
- Test usage reporting functionality
- Test optimization suggestions
- Test pricing configuration
- Test analytics accuracy

## QA Results

**Gate Decision**: PENDING
**Review Date**: TBD
**Reviewer**: TBD

**Risk Assessment**: TBD
**Risk Score**: TBD

**Key Findings**: TBD

**Recommendations**: TBD

**Risk Assessment**: [docs/qa/assessments/3.1-token-usage-tracking-risk-20241219.md](docs/qa/assessments/3.1-token-usage-tracking-risk-20241219.md)
**Gate File**: [docs/qa/gates/3.1-token-usage-tracking.yml](docs/qa/gates/3.1-token-usage-tracking.yml)

## Change Log

- Initial creation
