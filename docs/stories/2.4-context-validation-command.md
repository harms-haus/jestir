# Story 2.4: Context Validation Command

**Status:** Pending
**Epic:** 2 - Templates & LightRAG API Integration
**Story ID:** 2.4
**Title:** Context Validation Command
**Slug:** context-validation-command

## Story

As a parent,
I want to validate a context file before generation,
so that I can catch conflicts or missing references early.

## Acceptance Criteria

1. Command `jestir validate context.yaml` checks structure
2. Verify all entity references exist in LightRAG API
3. Check relationship consistency
4. Validate required settings are present
5. Warning for unusual patterns (e.g., no protagonists)
6. Clear error messages with fix suggestions

## Tasks/Subtasks

- [ ] Implement context file structure validation
- [ ] Add entity reference validation
- [ ] Implement relationship consistency checks
- [ ] Add required settings validation
- [ ] Create pattern analysis for warnings
- [ ] Add clear error message generation
- [ ] Create fix suggestion system
- [ ] Add validation command implementation
- [ ] Create comprehensive test coverage

## Dev Notes

This story provides validation capabilities for context files before story generation. It helps catch issues early and provides helpful suggestions for fixing problems. This is essential for maintaining data quality and preventing generation failures.

## Testing

- Test structure validation with various context files
- Test entity reference validation
- Test relationship consistency checks
- Test required settings validation
- Test pattern analysis warnings
- Test error message clarity
- Test fix suggestion accuracy
- Test validation command functionality

## QA Results

**Gate Decision**: CONCERNS
**Review Date**: 2024-12-19
**Reviewer**: Quinn (Test Architect)

**Risk Assessment**: COMPLETED
**Risk Score**: 72/100

**Key Findings**:

- 1 Critical risk: LightRAG API dependency and availability (TECH-001)
- 3 High risks: Entity reference validation complexity, YAML parsing reliability, Data integrity
- 5 Medium risks: Performance, auto-fix reliability, security, error messaging, rate limiting
- 3 Low risks: Template integration, user experience, monitoring

**Recommendations**:

- **Must Fix Before Production**: Address critical risk TECH-001 with circuit breaker pattern and robust fallback
- **High Priority Testing**: Comprehensive testing for entity validation, YAML parsing, and data integrity
- **Performance Optimization**: Implement streaming validation and progress indicators for large files
- **Enhanced Monitoring**: Add performance metrics, API success rates, and error tracking

**Risk Assessment**: [docs/qa/assessments/2.4-context-validation-command-risk-20241219.md](docs/qa/assessments/2.4-context-validation-command-risk-20241219.md)
**Gate File**: [docs/qa/gates/2.4-context-validation-command.yml](docs/qa/gates/2.4-context-validation-command.yml)

## Change Log

- Initial creation
